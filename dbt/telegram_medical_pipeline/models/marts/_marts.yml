version: 2

models:
  - name: dim_channels
    description: "Dimension table containing information about Telegram channels"
    columns:
      - name: channel_name
        description: "Primary key - name of the Telegram channel"
        tests:
          - unique
          - not_null
      - name: channel_id
        description: "Telegram channel ID"
      - name: category
        description: "Channel category (cosmetics, pharmaceuticals, medical_supplies, healthcare, pharmacy, general)"
      - name: priority
        description: "Channel priority level (high, medium, low)"
      - name: message_count
        description: "Total number of messages from this channel"
      - name: media_count
        description: "Number of messages with media"
      - name: medical_messages_count
        description: "Number of messages containing medical keywords"
      - name: price_messages_count
        description: "Number of messages containing price information"
      - name: avg_message_length
        description: "Average length of messages from this channel"
      - name: unique_senders
        description: "Number of unique senders in this channel"
      - name: first_message_date
        description: "Date of the first message from this channel"
      - name: last_message_date
        description: "Date of the most recent message from this channel"
      - name: medical_content_percentage
        description: "Percentage of messages containing medical keywords"
      - name: media_content_percentage
        description: "Percentage of messages containing media"
      - name: activity_level
        description: "Channel activity level (high, medium, low)"
      - name: channel_type
        description: "Type of channel based on content (medical_focused, media_heavy, commerce_focused, general)"

  - name: dim_dates
    description: "Dimension table for time-based analysis with comprehensive date attributes"
    columns:
      - name: date_id
        description: "Primary key - date in YYYY-MM-DD format"
        tests:
          - unique
          - not_null
      - name: year
        description: "Year"
      - name: month
        description: "Month (1-12)"
      - name: day
        description: "Day of month (1-31)"
      - name: day_of_week
        description: "Day of week (0=Sunday, 6=Saturday)"
      - name: day_of_year
        description: "Day of year (1-366)"
      - name: week_of_year
        description: "Week of year (1-53)"
      - name: quarter
        description: "Quarter (1-4)"
      - name: month_name
        description: "Full month name"
      - name: month_name_short
        description: "Abbreviated month name"
      - name: day_name
        description: "Full day name"
      - name: day_name_short
        description: "Abbreviated day name"
      - name: fiscal_year
        description: "Fiscal year (starts in July)"
      - name: fiscal_quarter
        description: "Fiscal quarter (1-4)"
      - name: is_business_day
        description: "Boolean indicating if this is a business day"
      - name: is_weekend
        description: "Boolean indicating if this is a weekend"
      - name: season
        description: "Season (Winter, Spring, Summer, Fall)"
      - name: ethiopian_year
        description: "Ethiopian calendar year (approximate)"

  - name: fct_messages
    description: "Fact table containing one row per message with foreign keys to dimension tables"
    columns:
      - name: raw_data_id
        description: "Foreign key to raw data table"
      - name: message_id
        description: "Primary key - Telegram message ID"
        tests:
          - unique
          - not_null
      - name: channel_name
        description: "Foreign key to dim_channels"
      - name: channel_id
        description: "Telegram channel ID"
      - name: sender_id
        description: "Telegram sender ID"
      - name: message_date_id
        description: "Foreign key to dim_dates"
      - name: message_text
        description: "Content of the message"
      - name: message_length
        description: "Length of the message text"
      - name: has_text
        description: "Boolean indicating if message has text"
      - name: has_media
        description: "Boolean indicating if message has media"
      - name: contains_medical_keywords
        description: "Boolean indicating if message contains medical keywords"
      - name: contains_price_info
        description: "Boolean indicating if message contains price information"
      - name: local_media_path
        description: "Path to downloaded media file"
      - name: media_type
        description: "Type of media (photo, video, document, etc.)"
      - name: media_file_size
        description: "Size of media file in bytes"
      - name: media_mime_type
        description: "MIME type of media file"
      - name: sender_username
        description: "Username of message sender"
      - name: sender_first_name
        description: "First name of message sender"
      - name: sender_last_name
        description: "Last name of message sender"
      - name: channel_category
        description: "Category of the channel (from dim_channels)"
      - name: channel_priority
        description: "Priority level of the channel (from dim_channels)"
      - name: channel_activity_level
        description: "Activity level of the channel (from dim_channels)"
      - name: channel_type
        description: "Type of channel (from dim_channels)"
      - name: message_length_category
        description: "Categorized message length (short, medium, long)"
      - name: message_type
        description: "Type of message (medical_commerce, medical_info, commerce, general)"
      - name: content_type
        description: "Type of content (medical_media, media_only, medical_text, text_only)"
      - name: message_year
        description: "Year of message (from dim_dates)"
      - name: message_month
        description: "Month of message (from dim_dates)"
      - name: message_day
        description: "Day of message (from dim_dates)"
      - name: message_day_of_week
        description: "Day of week of message (from dim_dates)"
      - name: message_quarter
        description: "Quarter of message (from dim_dates)"
      - name: message_month_name
        description: "Month name of message (from dim_dates)"
      - name: message_day_name
        description: "Day name of message (from dim_dates)"
      - name: message_is_business_day
        description: "Whether message was sent on a business day (from dim_dates)"
      - name: message_is_weekend
        description: "Whether message was sent on a weekend (from dim_dates)"
      - name: message_season
        description: "Season of message (from dim_dates)"

  - name: fct_image_detections
    description: "Fact table containing YOLO object detection results linked to messages"
    columns:
      - name: detection_id
        description: "Primary key - unique detection identifier"
        tests:
          - unique
          - not_null
      - name: message_id
        description: "Foreign key to fct_messages (when available)"
      - name: channel_name
        description: "Foreign key to dim_channels"
      - name: detected_object_class
        description: "Class name of detected object (e.g., person, bottle, car)"
        tests:
          - not_null
      - name: confidence_score
        description: "YOLO confidence score (0.0 to 1.0)"
        tests:
          - not_null
      - name: confidence_level
        description: "Categorized confidence level (high, medium, low)"
      - name: class_id
        description: "YOLO class ID"
      - name: object_category
        description: "Object category (medical, non_medical)"
      - name: is_medical_related
        description: "Boolean indicating if object is medical-related"
      - name: bbox_x1
        description: "Bounding box x1 coordinate"
      - name: bbox_y1
        description: "Bounding box y1 coordinate"
      - name: bbox_x2
        description: "Bounding box x2 coordinate"
      - name: bbox_y2
        description: "Bounding box y2 coordinate"
      - name: bbox_width
        description: "Width of bounding box"
      - name: bbox_height
        description: "Height of bounding box"
      - name: detection_area
        description: "Area of detected object"
      - name: relative_area_percentage
        description: "Relative area as percentage of image"
      - name: total_objects_in_image
        description: "Total objects detected in the image"
      - name: medical_objects_in_image
        description: "Number of medical objects in the image"
      - name: primary_object
        description: "Primary object in the image (highest confidence)"
      - name: primary_confidence
        description: "Confidence score of primary object"
      - name: avg_confidence
        description: "Average confidence across all detections in image"
      - name: content_type
        description: "Type of image content (medical_content, general_content, no_objects)"
      - name: detected_classes_array
        description: "Array of all detected object classes in the image"
      - name: file_path
        description: "Path to the original image file"
      - name: file_name
        description: "Name of the image file"
      - name: detection_time
        description: "Timestamp when detection was performed"
      - name: processing_time
        description: "Timestamp when detection data was processed"
      - name: model_used
        description: "YOLO model used for detection"
      - name: confidence_threshold
        description: "Confidence threshold used for detection" 